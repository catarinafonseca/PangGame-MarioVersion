<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario PANG</title>
</head>
<!-- style="background-color: black;" -->

<body>
    <div style="text-align:center">

        <canvas id="myCanvas" width="750" height="500">
            Your browser does not support HTML5 Canvas.

        </canvas>

    </div>
    <script>
        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext("2d");

        const W = canvas.width, H = canvas.height;

        //declaração das imagens
        let bgImage = new Image();
        let heartImage = new Image();
        let coinImage = new Image();
        let floor = new Image();
        floor.src = 'images/floor.png'
        bgImage.src = 'images/bg4.png';
        heartImage.src = 'images/heart.png';
        coinImage.src = 'images/coin.png';

        let luigiLeft = new Image();
        let luigiRight = new Image();
        let luigiBack = new Image();
        luigiRight.src = 'images/luigi1.png';
        luigiLeft.src = 'images/luigi2.png';
        luigiBack.src = 'images/luigi7.png';

        let turtle = new Image();
        let rastro = new Image();
        turtle.src = 'images/turtle.png';
        rastro.src = 'images/trail1.png';



        //declaração das variáveis
        let x = W - 450, y = H - 160;
        let rightKey = leftKey = upKey = false;
        let frameIndex = 0;
        let rightIndex = 0;
        let leftIndex = 0;
        let turtleX = x;
        let turtleY = y;
        let a = 0.5;

        //classe da moeda
        class Coin {
            constructor(ballX, ballY, ballW, ballH) {
                this.ballX = ballX;
                this.ballY = ballY;
                this.ballW = ballW;
                this.ballH = ballH;
                this.dX = 6 * Math.cos(-Math.PI / 3);
                this.dY = 19 * Math.sin(-Math.PI / 3);


            }
            
            update() { //função do movimento da moeda
                this.ballX += this.dX;
                this.ballY += this.dY;

                if (this.ballX + this.ballW > W || this.ballX < 0) {
                    this.dX = -this.dX;
                }

                if (this.ballY + this.ballH > H - 95) {
                    this.ballY = H - this.ballH - 95;
                    this.dY = -this.dY;

                }
                else {
                    this.dY = this.dY + a;
                }

                if (this.dY < 0 && this.dY > -2.1) {
                    this.dY = 0;
                }
            }

            draw() { //desenho da moeda
                ctx.beginPath();
                ctx.drawImage(coinImage, frameIndex * 100, 0, 100, 100,
                    this.ballX, this.ballY, this.ballW, this.ballH);
                frameIndex++;
                if (frameIndex == 10)
                    frameIndex = 0;
                ctx.closePath();
            }

        }

        let b = new Array();
        let xInit = 0;
        let yInit = H - 195;



        b.push(new Coin(xInit, yInit, 100, 100))

        function render() { //renderização do jogo
            ctx.clearRect(0, 0, W, H);

            //fundo preto

            //desenho do fundo e dos restantes elementos(imagens e texto)
            ctx.drawImage(bgImage, 0, 0, 750, 555, 0, 0, W + 50, H - 50);


            if (upKey && turtleY > -1) { //caso a tecla para cima seja pressionada - mandar o arpão

                ctx.drawImage(turtle, 0, 0, 29, 30, turtleX, turtleY - 38, 60, 70);
                ctx.drawImage(rastro, 0, 0, 16, 100, turtleX, turtleY, 40, 400);

                turtleY = turtleY - 10;
                console.log(turtleY);
            }

            if (turtleY == 0) { //retorna o arpão à personagem

                upKey = false
                turtleY = y
                turtleX = x
            }
            //conjunto de funções respetivo ao movimento da personagem
            if (!rightKey && !leftKey) { //caso nenhuma tecla de movimento seja pressionada
                ctx.drawImage(luigiBack, x, y, 33, 70);
            }

            if (rightKey && x < W - 50) { //caso a tecla da direita seja pressionada

                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x + 8;
                rightIndex++;
                if (rightIndex == 3)
                    rightIndex = 0;
            }

            if (rightKey && x == W - 50) { //evita que a personagem saia da tela do lado direito

                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);
                rightIndex++;
                if (rightIndex == 3)
                    rightIndex = 0;
            }

            if (leftKey && x > 4) { //caso a tecla da esquerda seja pressionada

                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x - 8;
                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;
            }

            if (leftKey && x == 4) { //evita que a personagem saia da tela do lado esquerdo

                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);
                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;
            }

            if (upKey && turtleY > 30) { //caso a tecla para cima seja pressionada - mandar o arpão

                ctx.drawImage(turtle, 0, 0, 29, 30, turtleX, turtleY - 38, 60, 70);
                turtleY = turtleY - 10
                
            }
            if(turtleY==30)
            {
                upKey=false;

            }


            b.forEach(function (coin) {
                coin.draw();
                coin.update();
            });




            ctx.fillStyle = "black";
            ctx.fillRect(0, H-50, W, H-450);
            ctx.drawImage(heartImage, W - 50, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 100, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 150, H - 45, 50, 50);
            ctx.fillStyle = "white";
            ctx.font = "30px Courier New ";
            ctx.fillText("Lives:", W - 255, H - 11);
            ctx.drawImage(floor, 0,-455, 750, 555, 0, 0, W , H );
            
        }

        setInterval(render, 1000 / 20)

        //conjunto de funções que controlam as teclas quando pressionadas e deixadas de estar pressionadas
        function ArrowPressed(e) {
            if (e.key == 'ArrowRight') {
                rightKey = true
                leftKey = false
            }

            if (e.key == 'ArrowLeft') {
                leftKey = true
                rightKey = false
            }
            

            if (e.key == 'ArrowUp' && upKey==false) {
                upKey = true
                leftKey = false
                rightKey = false
                turtleX=x
                turtleY=y
            }
        }

        function ArrowReleased(e) {
            if (e.key == 'ArrowRight')
                rightKey = false
            if (e.key == 'ArrowLeft')
                leftKey = false
        }

        window.addEventListener('keydown', ArrowPressed)
        window.addEventListener('keyup', ArrowReleased)
    </script>
</body>

</html>