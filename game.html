<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario PANG</title>
</head>
<!-- style="background-color: black;" -->

<body>

    <div style="text-align:center">

        <canvas id="myCanvas" width="750" height="500" style="border:solid 20px black">
            Your browser does not support HTML5 Canvas.

        </canvas>

    </div>
    <script>
        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext("2d");

        const W = canvas.width, H = canvas.height;

        //declaração das imagens
        let bgImage = new Image();
        let heartImage = new Image();
        let coinImage = new Image();
        bgImage.src = 'images/bg4.png';
        heartImage.src = 'images/heart.png'
        coinImage.src = 'images/coin.png';

        let luigiLeft = new Image();
        let luigiRight = new Image();
        let luigiBack = new Image();
        luigiRight.src = 'images/luigi1.png'
        luigiLeft.src = 'images/luigi2.png'
        luigiBack.src = 'images/luigi7.png'

        let x = W - 450, y = H - 160;
        let rightKey = leftKey = upKey = false;
        let frameIndex = 0;
        let rightIndex = 0;
        let leftIndex = 0;
        let gravity = 0.5
        let bounce = 0.7
        class Coin {
            constructor(ballX, ballY, ballW, ballH, v, d) {
                this.ballX = ballX;
                this.ballY = ballY;
                this.ballW = ballW;
                this.ballH = ballH;
                this.dX = 5 * Math.cos(d);
                this.dY = 5 * Math.sin(d);
                this.v = v;

            }
            update() {

                this.ballX += this.dX;
                this.ballY += this.dY;
                this.dY += gravity



                if (this.ballX + this.ballW > W || this.ballX < 0) {
                    this.dX = -this.dX;
                }
                if (this.ballY + this.ballH > H - 90) {
                    this.ballY = H - this.ballH - 90;
                     this.dY *= -bounce; 


                }
                if (this.ballY <= 0) {
                    this.dY += -this.dY;

                }
                 if (this.dY < 0 && this.dY > -2.1) {

                    this.dY = 0;
                    
                }  

              
            }

            draw() {

                ctx.beginPath();
                ctx.drawImage(coinImage, frameIndex * 100, 0, 100, 100,
                    this.ballX, this.ballY, this.ballW, this.ballH);
                frameIndex++;
                if (frameIndex == 10)
                    frameIndex = 0;
                ctx.closePath();
            }

        }

        let b = new Array();
        let xInit = W / 2;
        let yInit = H / 4;
        let velocity = 5;
        let direction = Math.random() * 2 * Math.PI

        b.push(new Coin(xInit, yInit, 50, 50, velocity, direction))


        function render() {
            ctx.clearRect(0, 0, W, H);
            //fundo preto
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, W, H);
            ctx.drawImage(bgImage, 0, 0, 750, 555, 0, 0, W + 50, H - 50);
            ctx.drawImage(heartImage, W - 50, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 100, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 150, H - 45, 50, 50);
            ctx.fillStyle = "white";
            ctx.font = "30px Courier New ";
            ctx.fillText("Lives:", W - 255, H - 11);


            if (!rightKey && !leftKey) {
                ctx.drawImage(luigiBack, x, y, 33, 70);
            }

            if (rightKey && x < W - 50) {

                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x + 8;
                rightIndex++;
                if (rightIndex == 3)
                    rightIndex = 0;
            }

            if (rightKey && x == W - 50) {

                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);

                rightIndex++;
                if (rightIndex == 3)
                    rightIndex = 0;

            }

            if (leftKey && x > 4) {

                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x - 8;
                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;

            }

            if (leftKey && x == 4) {

                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);

                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;

            }
            
            if(upKey){  //mandar o arpão
                turtleX = x;
                turtleY = y;
                ctx.drawImage(turtle, 0, 0, 29, 30, turtleX, turtleY - 38, 60, 70);
                turtleY--;

            }
            b.forEach(function (coin) {
                coin.draw();
                coin.update();
            });


        }

        setInterval(render, 1000 / 20);

        function ArrowPressed(e) {
            if (e.key == 'ArrowRight') {
                rightKey = true
                leftKey = false
            }

            if (e.key == 'ArrowLeft') {
                leftKey = true
                rightKey = false
            }

        }
        function ArrowReleased(e) {
            if (e.key == 'ArrowRight')
                rightKey = false
            if (e.key == 'ArrowLeft') 
                leftKey = false
            if (e.key == 'ArrowUp') 
                upKey = false


        }

        window.addEventListener('keydown', ArrowPressed)
        window.addEventListener('keyup', ArrowReleased)
        
    </script>
</body>

</html>