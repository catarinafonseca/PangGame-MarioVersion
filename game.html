<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Mario PANG</title>
</head>
<!-- style="background-color: black;" -->

<body>

    <div style="text-align:center">

        <canvas id="myCanvas" width="750" height="500" style="border:solid 20px black">
            Your browser does not support HTML5 Canvas.

        </canvas>

    </div>
    <script>
        const canvas = document.querySelector('#myCanvas');
        const ctx = canvas.getContext("2d");

        const W = canvas.width, H = canvas.height;

        //declaração das imagens
        let bgImage = new Image();
        let heartImage = new Image();
        let coinImage = new Image();
        bgImage.src = 'images/bg4.png';
        heartImage.src = 'images/heart.png'
        coinImage.src = 'images/coin.png';

        let luigiLeft = new Image();
        let luigiRight = new Image();
        let luigiBack = new Image();
        luigiRight.src = 'images/luigi1.png'
        luigiLeft.src = 'images/luigi2.png'
        luigiBack.src = 'images/luigi7.png'

        let turtle = new Image();
        turtle.src = 'images/turtle.png'

        //declaração das variáveis
        let x = W - 450, y = H - 160;
        let rightKey = leftKey = upKey = false;
        let frameIndex = 0;
        let rightIndex = 0;
        let leftIndex = 0;
        let upIndex = 0;
        let ball;
        let ballX = W/2;
        let ballY = 50;
        let ballW = 50;
        let ballH = 50;
        let turtleX;
        let turtleY;
        let direction = Math.random() * 2 * Math.PI;
        var vx = 5 * Math.cos(direction);
        var vy = 5 * Math.sin(direction);


        function render() {
            ctx.clearRect(0, 0, W, H);
            //fundo preto
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, W, H);
            //desenho do background e das vidas
            ctx.drawImage(bgImage, 0, 0, 750, 555, 0, 0, W + 50, H - 50);
            ctx.drawImage(heartImage, W - 50, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 100, H - 45, 50, 50);
            ctx.drawImage(heartImage, W - 150, H - 45, 50, 50);
           //texto
            ctx.fillStyle = "white";
            ctx.font = "30px Courier New ";
            ctx.fillText("Lives:", W - 255, H - 11);

            //ficar parado
            if(!rightKey && !leftKey){
                ctx.drawImage(luigiBack, x, y, 33, 70);
            }
            //andar para a direita
            if (rightKey && x < W - 58) {
                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x + 8;
                rightIndex++;
                if (rightIndex == 3)
                    rightIndex = 0;
            }
            if(rightKey && x == W - 58){ //andar contra a parede direita
                ctx.drawImage(luigiRight, rightIndex * 29, 0, 29, 30, x, y, 60, 70);
                rightIndex++;
                if(rightIndex == 3)
                    rightIndex = 0     
            }
            //andar para a esquerda
            if (leftKey && x > 4) { 
                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);
                x = x - 8;
                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;
            }
            if(leftKey && x == 4){ //andar contra a parede esquerda
                console.log('entrou');
                ctx.drawImage(luigiLeft, leftIndex * 29, 0, 29, 30, x, y, 60, 70);
                leftIndex++;
                if (leftIndex == 3)
                    leftIndex = 0;

            }
            if(upKey){  //mandar o arpão
                turtleX = x;
                turtleY = y;
                ctx.drawImage(turtle, 0, 0, 29, 30, turtleX, turtleY - 38, 60, 70);
                turtleY = turtleY - 10;


            }
            //desenho da moeda
            ctx.beginPath();
            ball = ctx.drawImage(coinImage, frameIndex * 100, 0, 100, 100,
                ballX, ballY, ballW, ballH);
            frameIndex++;
            if (frameIndex == 10)
                frameIndex = 0;
            ctx.closePath();

            ballMovement();
        }

        setInterval(render, 1000 / 20); 
        
        function ballMovement() { //movimento da moeda
 
            ballX += vx;
            ballY += vy;
            
            if (ballX + ballW > W || ballX< 0) {
                vx = -vx;
            }
            if (ballY + ballH > H - 90 ) {
                ballY = H - ballH - 90;
                vy = -vy;
            }
            if (ballY< 0) {
                vy = -vy;
            }

        }

        //controlo das interações do keyboard
        function ArrowPressed(e) {
            if (e.key == 'ArrowRight'){
                rightKey = true
                leftKey = false
            }
                
            if (e.key == 'ArrowLeft'){
                rightKey = false
                leftKey = true 
            }  
            if (e.key == 'ArrowUp')
                upKey = true
        }
        function ArrowReleased(e) {
            if (e.key == 'ArrowRight')
                rightKey = false
            if (e.key == 'ArrowLeft') 
                leftKey = false
            if (e.key == 'ArrowUp') 
                upKey = false


        }

        window.addEventListener('keydown', ArrowPressed)
        window.addEventListener('keyup', ArrowReleased)
    </script>
</body>

</html>